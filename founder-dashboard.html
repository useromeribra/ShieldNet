<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¤Ø³Ø³ | ShieldNet</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #2c3e50, #4ca1af);
    margin: 0; padding: 0;
    color: white;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    width: 100%;
    background: rgba(0,0,0,0.6);
    padding: 1rem 2rem;
    text-align: center;
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
  }
  main {
    width: 90%;
    max-width: 800px;
    margin-top: 2rem;
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    padding: 1.5rem 2rem;
  }
  h1, h2 {
    margin-bottom: 1rem;
    text-align: center;
  }
  label, button {
    display: block;
    margin: 1rem auto;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
  }
  input[type="password"] {
    width: 250px;
    padding: 0.5rem;
    border-radius: 8px;
    border: none;
    margin-top: 0.5rem;
    font-size: 1rem;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  button {
    background-color: #f39c12;
    border: none;
    padding: 0.8rem 2rem;
    border-radius: 30px;
    font-size: 1.1rem;
    color: #222;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #d78e10;
  }
  .info {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  .toggle-btn {
    margin: 0.5rem auto;
    padding: 0.6rem 1.5rem;
    border-radius: 30px;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<header>
  <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¤Ø³Ø³</h1>
  <p class="info">Ø§Ù„Ù‡Ø¯Ù: Ø¨Ù†Ø§Ø¡ Ù…Ø¬ØªÙ…Ø¹ Ø®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¯Ù…Ø§Ù† | Ø§Ù„Ø±Ø³Ø§Ù„Ø©: Ø£Ù†Øª ØªØ³ØªØ·ÙŠØ¹ ğŸ’ª</p>
</header>

<main>
  <div id="authSection">
    <label for="founderPass">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ø³Ø³:</label>
    <input type="password" id="founderPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="new-password" />
    <button id="authBtn">Ø¯Ø®ÙˆÙ„</button>
    <p id="authMsg" style="color:#f39c12;"></p>
  </div>

  <div id="dashboardContent" class="hidden">
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙŠØ§ Ù…Ø¤Ø³Ø³ ShieldNet</h2>

    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†: <span id="userCount">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>

    <button id="toggleNaira" class="toggle-btn">ØªØ´ØºÙŠÙ„ Ù†Ø§ÙŠØ±Ø§ (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ)</button>
    <button id="toggleMarketingKing" class="toggle-btn">ØªØ´ØºÙŠÙ„ Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚</button>

    <label for="changePassInput">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³:</label>
    <input type="password" id="changePassInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" autocomplete="new-password" />
    <button id="changePassBtn">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

    <button id="logoutBtn" style="margin-top:2rem;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</main>

<script type="module" src="firebase.js"></script>
<script type="module">
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, getDocs, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const auth = getAuth();
  const db = getFirestore();

  const founderPassInput = document.getElementById('founderPass');
  const authBtn = document.getElementById('authBtn');
  const authMsg = document.getElementById('authMsg');
  const dashboardContent = document.getElementById('dashboardContent');
  const authSection = document.getElementById('authSection');

  const userCountSpan = document.getElementById('userCount');
  const toggleNairaBtn = document.getElementById('toggleNaira');
  const toggleMarketingBtn = document.getElementById('toggleMarketingKing');
  const changePassInput = document.getElementById('changePassInput');
  const changePassBtn = document.getElementById('changePassBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ø¤Ø³Ø³
  let founderPassword = localStorage.getItem('founderPassword') || 'usertheking';

  // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Firebase
  onAuthStateChanged(auth, user => {
    if (!user) {
      authMsg.textContent = 'ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø³Ø³ Firebase.';
      disableDashboard();
      return;
    }
    if (user.email !== 'founder@shieldnet.com') {
      authMsg.textContent = 'ØºÙŠØ± Ù…Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø³Ø³.';
      disableDashboard();
      return;
    }
    // Ø¥Ø¨Ù‚Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ø±Ø¦ÙŠ Ø­ØªÙ‰ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØµØ­ÙŠØ­Ø©
    enableAuthCheck();
  });

  // ØªÙ…ÙƒÙŠÙ†/ØªØ¹Ø·ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  function enableAuthCheck() {
    authSection.style.display = 'block';
    dashboardContent.style.display = 'none';
  }
  function disableDashboard() {
    authSection.style.display = 'none';
    dashboardContent.style.display = 'none';
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø¤Ø³Ø³
  authBtn.addEventListener('click', () => {
    if (founderPassInput.value === founderPassword) {
      // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø³Ø³
      authSection.style.display = 'none';
      dashboardContent.style.display = 'block';
      authMsg.textContent = '';
      loadUserCount();
      loadAssistantsStatus();
    } else {
      authMsg.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!';
    }
  });

  // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firestore
  async function loadUserCount() {
    try {
      const usersCol = collection(db, "users");
      const snapshot = await getDocs(usersCol);
      userCountSpan.textContent = snapshot.size;
    } catch (e) {
      userCountSpan.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
      console.error(e);
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ù†Ø§ÙŠØ±Ø§ ÙˆÙ…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ù…Ù† Firestore
  async function loadAssistantsStatus() {
    try {
      const docRef = doc(db, "adminSettings", "assistantsStatus");
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        updateToggleButtons(data);
      } else {
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        updateToggleButtons({ naira: false, marketingKing: false });
      }
    } catch (e) {
      console.error(e);
    }
  }

  function updateToggleButtons(data) {
    toggleNairaBtn.textContent = data.naira ? "Ø¥ÙŠÙ‚Ø§Ù Ù†Ø§ÙŠØ±Ø§ (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ)" : "ØªØ´ØºÙŠÙ„ Ù†Ø§ÙŠØ±Ø§ (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ)";
    toggleMarketingBtn.textContent = data.marketingKing ? "Ø¥ÙŠÙ‚Ø§Ù Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚" : "ØªØ´ØºÙŠÙ„ Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚";
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ù†Ø§ÙŠØ±Ø§
  toggleNairaBtn.addEventListener('click', async () => {
    try {
      const docRef = doc(db, "adminSettings", "assistantsStatus");
      const currentStatus = toggleNairaBtn.textContent.includes("Ø¥ÙŠÙ‚Ø§Ù");
      await setDoc(docRef, { naira: !currentStatus }, { merge: true });
      toggleNairaBtn.textContent = !currentStatus ? "Ø¥ÙŠÙ‚Ø§Ù Ù†Ø§ÙŠØ±Ø§ (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ)" : "ØªØ´ØºÙŠÙ„ Ù†Ø§ÙŠØ±Ø§ (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ)";
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù†Ø§ÙŠØ±Ø§");
      console.error(e);
    }
  });

  // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚
  toggleMarketingBtn.addEventListener('click', async () => {
    try {
      const docRef = doc(db, "adminSettings", "assistantsStatus");
      const currentStatus = toggleMarketingBtn.textContent.includes("Ø¥ÙŠÙ‚Ø§Ù");
      await setDoc(docRef, { marketingKing: !currentStatus }, { merge: true });
      toggleMarketingBtn.textContent = !currentStatus ? "Ø¥ÙŠÙ‚Ø§Ù Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚" : "ØªØ´ØºÙŠÙ„ Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚";
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù…Ù„Ùƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚");
      console.error(e);
    }
  });

  // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ø³Ø³
  changePassBtn.addEventListener('click', () => {
    const newPass = changePassInput.value.trim();
    if (newPass.length < 6) {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
      return;
    }
    founderPassword = newPass;
    localStorage.setItem('founderPassword', newPass);
    alert("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ø³Ø³ Ø¨Ù†Ø¬Ø§Ø­");
    changePassInput.value = "";
  });

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  });

</script>
</body>
</html>
